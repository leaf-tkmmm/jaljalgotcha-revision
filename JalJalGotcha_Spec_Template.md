# 📜 JalJalGotcha 仕様書テンプレート（Claude用）

## 1. プロジェクト概要

* **アプリ名**: JalJalGotcha
* **目的**: 指定した分数以内で収まる「ジャルジャル動画の組み合わせ」を自動生成し、Web上で表示する。

---

## 2. 使用技術スタック（予定）

* **フロントエンド**: Next.js
* **バックエンド**: Next.js API Routes
* **デプロイ先**: Vercel

### アーキテクチャ方針

* **ビジネスロジック**: API側（Next.js API Routes）に実装
* **バリデーション**: サーバー側で実装し、クライアント側はUI用の軽量チェックのみ
* **データモデル**: `models/` フォルダに定義し、Single Source of Truth として管理

---

## 3. データ仕様

* **データ形式**: JSON
* **格置場所**: サーバー内に静的ファイル
* **データモデル定義**: `models/` フォルダに TypeScript 定義を配置し、フロントエンド・バックエンド両方で共通利用

### 動画情報モデル（Video）

```json
{
  "id": "video_001",
  "title": "ネタタイトル",
  "duration": 185,
  "url": "https://youtube.com/xxx",
  "thumbnail": "https://img.youtube.com/xxx.jpg",
  "channel_id": "UChwgNUWPM-ksOP3BbfQHS5Q"
}
```

### リクエスト・レスポンスモデル

```typescript
// models/gacha.ts
interface GachaRequest {
  minutes: number; // 1-1000
}

interface GachaResponse {
  videos: Video[];
  totalDuration: number;
  remainingSeconds: number;
}
```

* **備考**: duration は秒単位。動画データはあらかじめ `duration` 昇順でソートされた状態で `videos.json` に保存されるため、アプリ側でのソート処理は不要。

---

## 4. ユーザー操作の流れ

1. 時間を分単位で入力（1〜1000）
2. 「ガチャ」ボタンを押す
3. 条件に合う動画の組み合わせが表示される
4. 結果の動画リストから各動画をクリック → YouTubeに遷移

---

## 5. 機能要件

### ✅ 入力

* 数値のみ（バリデーションあり）
* 入力範囲: `1 ≤ X ≤ 1000`
* **バリデーション実装場所**:
  * **サーバー側**: API Routes で厳密なバリデーション実装（必須）
  * **クライアント側**: UI/UX向上のための軽量チェック（任意）
* バリデーション失敗時: エラーメッセージ表示

### ✅ 出力

* **組み合わせ条件**: 
  * 合計時間がユーザー入力値よりも短い
  * **差分は1分（60秒）未満になるよう最適化**
* 表示要素:
  * タイトル
  * 所要時間（分: 秒）
  * サムネイル画像
  * YouTubeリンク
* \[任意] 総所要時間 or 残り時間の表示

---

## 6. アルゴリズム仕様

**実装場所**: API Routes（サーバー側）でビジネスロジックを実装

### 💡 処理手順

1. **API初期化時**: `videos.json` を読み込み、`duration` 昇順でソート済みのデータをメモリにキャッシュ
2. **API リクエスト受信時**:
   
   a. **入力バリデーション**: `1 ≤ minutes ≤ 1000` の範囲チェック
   b. **目標時間設定**: `targetSeconds = minutes * 60`
   c. **組み合わせ生成**:
      - 使用済み動画IDを記録する `Set` を用意
      - 残り時間内に収まる動画を候補として抽出
      - 候補から未使用の動画をランダム選択
      - 選択した動画を結果に追加し、残り時間を更新
      - **終了条件**: 残り時間が60秒未満になるまで繰り返し
   d. **最適化チェック**: 合計時間と目標時間の差が60秒未満になるよう調整
   e. **レスポンス生成**: 選択された動画リスト、合計時間、残り時間を返却

### 🎯 最適化目標

* 目標時間に対する残り時間を1分（60秒）未満に抑制
* ランダム性を保ちつつ、時間効率を最大化

---

## 7. UI要件

* レスポンシブデザイン
* スマホ対応（縦長でも閲覧快適に）